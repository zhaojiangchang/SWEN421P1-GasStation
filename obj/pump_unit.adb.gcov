        -:    0:Source:C:/Users/JackyChang/Documents/421A1/src/pump_unit.adb
        -:    0:Programs:38
        -:    1:with sPrint; use sPrint;
        -:    2:with PUMP;
        -:    3:with Ada.Exceptions;
        -:    4:package body PUMP_UNIT
        -:    5:with SPARK_Mode is
        -:    6:   --------------
        -:    7:   -- ADD_PUMP --
        -:    8:   --------------
        -:    9:
       14:   10:   procedure ADD_PUMP(pumpUnit: in out PUMP_UNIT; pump_r : in out PUMP.PUMP; fuelType: in PUMP.FUEL_TYPES) is
        -:   11:      --        p91 : PUMP;
        -:   12:      --        p95 : PUMP;
        -:   13:      --        pDiesel : PUMP;
        -:   14:
        -:   15:      nozzleStateType: PUMP.NOZZLE_TYPE;
        -:   16:      baseStateType: PUMP.STATE_TYPE;
        -:   17:   begin
       14:   18:      baseStateType:= PUMP.STATE_TYPE'val(0);
       14:   19:      nozzleStateType := PUMP.NOZZLE_TYPE'val(0);
        -:   20:
       14:   21:      case fuelType is
        -:   22:         when PUMP.U91 =>
       14:   23:            print("add pump: 91");
       14:   24:            PUMP.SET_FUEL_PRICE(pump_r,1.80);
       14:   25:            PUMP.SET_PUMP_STATE(pump_r,baseStateType);
       14:   26:            PUMP.APPEND_RESERVOIR(pump_r,fuelType);
       14:   27:            PUMP.SET_RESERVOIR_SIZE(pump_r, 1000.00);
       14:   28:            pumpUnit.PUMP_91 := pump_r;
       14:   29:            pumpUnit.IS_USING := False;
       14:   30:            pumpUnit.IS_PAID := True;
       14:   31:            pumpUnit.TO_PAY:= 0.00;
       14:   32:            pumpUnit.PUMPED:=0.00;
       14:   33:            pumpUnit.PUMP_ACTIVE_STATE :=baseStateType;
       14:   34:            pumpUnit.PUMP_NOZZLE_STATE := nozzleStateType;
       14:   35:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r, nozzleStateType);
        -:   36:         when PUMP.U95 =>
    #####:   37:            print("add pump: 95");
    #####:   38:            PUMP.SET_FUEL_PRICE(pump_r,2.10);
    #####:   39:            PUMP.SET_PUMP_STATE(pump_r,baseStateType);
    #####:   40:            PUMP.APPEND_RESERVOIR(pump_r, fuelType);
    #####:   41:            PUMP.SET_RESERVOIR_SIZE(pump_r, 1000.00);
    #####:   42:            pumpUnit.PUMP_95 := pump_r;
    #####:   43:            pumpUnit.IS_USING := False;
    #####:   44:            pumpUnit.IS_PAID := True;
    #####:   45:            pumpUnit.TO_PAY:= 0.00;
    #####:   46:            pumpUnit.PUMPED:=0.00;
    #####:   47:            pumpUnit.PUMP_ACTIVE_STATE :=baseStateType;
    #####:   48:            pumpUnit.PUMP_NOZZLE_STATE := nozzleStateType;
    #####:   49:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r, nozzleStateType);
        -:   50:         when PUMP.Diesel =>
    #####:   51:            print("add pump: Diesel");
    #####:   52:            PUMP.SET_FUEL_PRICE(pump_r,1.10);
    #####:   53:            PUMP.SET_PUMP_STATE(pump_r,baseStateType);
    #####:   54:            PUMP.APPEND_RESERVOIR(pump_r, fuelType);
    #####:   55:            PUMP.SET_RESERVOIR_SIZE(pump_r, 1000.00);
    #####:   56:            pumpUnit.PUMP_Diesel := pump_r;
    #####:   57:            pumpUnit.IS_USING := False;
    #####:   58:            pumpUnit.IS_PAID := True;
    #####:   59:            pumpUnit.TO_PAY:= 0.00;
    #####:   60:            pumpUnit.PUMPED:=0.00;
    #####:   61:            pumpUnit.PUMP_ACTIVE_STATE :=baseStateType;
    #####:   62:            pumpUnit.PUMP_NOZZLE_STATE := nozzleStateType;
    #####:   63:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r, nozzleStateType);
        -:   64:
       14:   65:      end case;
       14:   66:      print("");
       14:   67:   end ADD_PUMP;
        -:   68:   --------------------
        -:   69:   -- SET_PUMPED --
        -:   70:   --------------------
        4:   71:   procedure SET_PUMPED(pumpUnit: in out PUMP_UNIT;  AMOUNT: in PUMP.FLOAT_NUMBER)
        -:   72:   is
        -:   73:   begin
        4:   74:      pumpUnit.PUMPED := AMOUNT;
        4:   75:   end SET_PUMPED;
        -:   76:
        -:   77:   --------------------
        -:   78:   -- SET_PUMPED --
        -:   79:   --------------------
        4:   80:   procedure SET_TO_PAY(pumpUnit: in out PUMP_UNIT;  AMOUNT: in PUMP.FLOAT_NUMBER)
        -:   81:   is
        -:   82:   begin
        4:   83:      pumpUnit.TO_PAY := AMOUNT;
        4:   84:   end SET_TO_PAY;
        -:   85:
        -:   86:   --------------------
        -:   87:   -- GET_PUMP --
        -:   88:   --------------------
    #####:   89:   function GET_PUMP(pumpUnit: in PUMP_UNIT; fuelType: in PUMP.FUEL_TYPES) return PUMP.PUMP
        -:   90:   is
        -:   91:   begin
    #####:   92:      case fuelType is
    #####:   93:         when PUMP.U91 => return pumpUnit.PUMP_91;
    #####:   94:         when PUMP.U95 => return pumpUnit.PUMP_95;
    #####:   95:         when PUMP.Diesel => return pumpUnit.PUMP_Diesel;
        -:   96:      end case;
        -:   97:   end GET_PUMP;
        -:   98:
        -:   99:   --------------------
        -:  100:   -- GET TANK SIZE --
        -:  101:   --------------------
        -:  102:
    #####:  103:   function GET_TANKS_SIZE(pumpUnit: in PUMP_UNIT; fuelType: in PUMP.FUEL_TYPES) return PUMP.FLOAT_NUMBER
        -:  104:   is
        -:  105:   begin
    #####:  106:      case fuelType is
    #####:  107:         when PUMP.U91 => return PUMP.GET_TANKS_SIZE(pumpUnit.PUMP_91);
    #####:  108:         when PUMP.U95 => return PUMP.GET_TANKS_SIZE(pumpUnit.PUMP_95);
    #####:  109:         when PUMP.Diesel => return PUMP.GET_TANKS_SIZE(pumpUnit.PUMP_Diesel);
        -:  110:      end case;
        -:  111:   end GET_TANKS_SIZE;
        -:  112:
        -:  113:   --------------------
        -:  114:   -- GET ID ----------
        -:  115:   --------------------
       14:  116:   function GET_ID(pumpUnit: in PUMP_UNIT) return UNIT_ID_TYPE
        -:  117:   is
        -:  118:   begin
       14:  119:      return pumpUnit.ID;
        -:  120:   end GET_ID;
        -:  121:
        -:  122:   --------------------
        -:  123:   -- GET TO PAY ------
        -:  124:   --------------------
       24:  125:   function GET_TO_PAY(pumpUnit: in PUMP_UNIT) return PUMP.FLOAT_NUMBER
        -:  126:   is
        -:  127:   begin
       24:  128:      return pumpUnit.TO_PAY;
        -:  129:   end GET_TO_PAY;
        -:  130:
        -:  131:   --------------------
        -:  132:   -- GET PUMPED ------
        -:  133:   --------------------
        4:  134:   function GET_PUMPED(pumpUnit: in PUMP_UNIT) return PUMP.FLOAT_NUMBER
        -:  135:   is
        -:  136:   begin
        4:  137:      return pumpUnit.PUMPED;
        -:  138:   end GET_PUMPED;
        -:  139:
        -:  140:   --------------------
        -:  141:   -- GET FUEL   ------
        -:  142:   --------------------
        4:  143:   function GET_FUEL(pumpUnit: in PUMP_UNIT) return PUMP.FUEL_TYPES
        -:  144:   is
        -:  145:   begin
        4:  146:      return pumpUnit.PUMP_ACTIVE_FUEL;
        -:  147:   end GET_FUEL;-----------------------
        -:  148:   -- SET_IS_USING False--
        -:  149:   -----------------------
    #####:  150:   procedure SET_IS_USING(pumpUnit: in out PUMP_UNIT)
        -:  151:   is
        -:  152:      use all type PUMP.STATE_TYPE;
        -:  153:      baseStateType: PUMP.STATE_TYPE;
        -:  154:
        -:  155:   begin
    #####:  156:      baseStateType:= PUMP.STATE_TYPE'val(0);
    #####:  157:      if PUMP.GET_STATE(pumpUnit.PUMP_91) = baseStateType and PUMP.GET_STATE(pumpUnit.PUMP_95) =baseStateType and PUMP.GET_STATE(pumpUnit.PUMP_Diesel) = baseStateType  then
    #####:  158:         pumpUnit.IS_USING := False;
    #####:  159:         print("set pump unit initial is used to false ");
        -:  160:      end if;
    #####:  161:   end SET_IS_USING;
        -:  162:   -----------------------
        -:  163:   -- SET_IS_Paid true  --
        -:  164:   -----------------------
        4:  165:   procedure SET_IS_PAID(pumpUnit: in out PUMP_UNIT)
        -:  166:   is
        -:  167:      use all type PUMP.STATE_TYPE;
        -:  168:      baseStateType: PUMP.STATE_TYPE;
        -:  169:   begin
        4:  170:      if(pumpUnit.IS_PAID = False) then
    #####:  171:         baseStateType:= PUMP.STATE_TYPE'val(0);
    #####:  172:         if PUMP.GET_STATE(pumpUnit.PUMP_91) = baseStateType and PUMP.GET_STATE(pumpUnit.PUMP_95) = baseStateType and PUMP.GET_STATE(pumpUnit.PUMP_Diesel) =  baseStateType then
    #####:  173:            pumpUnit.IS_PAID := True;
    #####:  174:            print("set pump unit initial is paid to true ");
        -:  175:         end if;
        -:  176:      else
        4:  177:         pumpUnit.IS_PAID := False;
        -:  178:      end if;
        4:  179:   end SET_IS_PAID;
        -:  180:   -----------------------
        -:  181:   -- SET_UNIT_ID  --
        -:  182:   -----------------------
       14:  183:   procedure SET_UNIT_ID(pumpUnit: in out PUMP_UNIT; ID: in UNIT_ID_TYPE)
        -:  184:   is
        -:  185:   begin
       14:  186:      pumpUnit.ID := ID;
       14:  187:   end SET_UNIT_ID;
        -:  188:   -----------------------
        -:  189:   -- SET_PUMP_ACTIVE  --
        -:  190:   -----------------------
    #####:  191:   procedure SET_PUMP_ACTIVE_STATE(pumpUnit: in out PUMP_UNIT; fuelType: in PUMP.FUEL_TYPES; stateType: in PUMP.STATE_TYPE)
        -:  192:   is
        -:  193:   begin
    #####:  194:      if PUMP.FUEL_TYPES'Pos(fuelType) =0 then
    #####:  195:         pumpUnit.PUMP_ACTIVE_FUEL := fuelType;
    #####:  196:         PUMP.SET_PUMP_STATE(pumpUnit.PUMP_91,stateType);
    #####:  197:      elsif PUMP.FUEL_TYPES'Pos(fuelType) = 1 then
    #####:  198:         pumpUnit.PUMP_ACTIVE_FUEL :=fuelType;
    #####:  199:         PUMP.SET_PUMP_STATE(pumpUnit.PUMP_95,stateType);
    #####:  200:      elsif PUMP.FUEL_TYPES'Pos(fuelType) = 2 then
    #####:  201:         pumpUnit.PUMP_ACTIVE_FUEL := fuelType;
    #####:  202:         PUMP.SET_PUMP_STATE(pumpUnit.PUMP_Diesel, stateType);
        -:  203:      end if;
        -:  204:
    #####:  205:   end SET_PUMP_ACTIVE_STATE;
        -:  206:   -----------------------
        -:  207:   -- SET_PUMP_NOZZLE_STATE_ACTIVE  --
        -:  208:   -----------------------
    #####:  209:   procedure SET_PUMP_NOZZLE_STATE(pumpUnit: in out PUMP_UNIT; fuelType: in PUMP.FUEL_TYPES; nozzleType: in PUMP.NOZZLE_TYPE)
        -:  210:   is
        -:  211:   begin
    #####:  212:      if PUMP.FUEL_TYPES'Pos(fuelType) =0 then
    #####:  213:         PUMP.SET_PUMP_NOZZLE_STATE(pumpUnit.PUMP_91, nozzleType);
    #####:  214:         pumpUnit.PUMP_NOZZLE_STATE := nozzleType;
    #####:  215:      elsif PUMP.FUEL_TYPES'Pos(fuelType) = 1 then
    #####:  216:         PUMP.SET_PUMP_NOZZLE_STATE(pumpUnit.PUMP_95, nozzleType);
    #####:  217:         pumpUnit.PUMP_NOZZLE_STATE := nozzleType;
    #####:  218:      elsif PUMP.FUEL_TYPES'Pos(fuelType) = 2 then
    #####:  219:         PUMP.SET_PUMP_NOZZLE_STATE(pumpUnit.PUMP_Diesel, nozzleType);
    #####:  220:         pumpUnit.PUMP_NOZZLE_STATE := nozzleType;
        -:  221:      end if;
        -:  222:
    #####:  223:   end SET_PUMP_NOZZLE_STATE;
        -:  224:
        -:  225:   -----------------------
        -:  226:   -- UNIT_IS_USING     --
        -:  227:   -----------------------
    #####:  228:   function UNIT_IS_USING(pumpUnit: in PUMP_UNIT) return Boolean
        -:  229:   is
        -:  230:   begin
    #####:  231:      return pumpUnit.IS_USING;
        -:  232:   end UNIT_IS_USING;
        -:  233:
        -:  234:   -----------------------
        -:  235:   -- UNIT_IS_PAID      --
        -:  236:   -----------------------
    #####:  237:   function UNIT_IS_PAID(pumpUnit: in PUMP_UNIT) return Boolean
        -:  238:   is
        -:  239:   begin
    #####:  240:      return pumpUnit.IS_PAID;
        -:  241:   end UNIT_IS_PAID;
        -:  242:
        -:  243:   -----------------------
        -:  244:   -- GET_PUMP_UNIT_STATE      --
        -:  245:   -----------------------
    #####:  246:   function GET_PUMP_UNIT_STATE(pumpUnit: in PUMP_UNIT) return PUMP.STATE_TYPE
        -:  247:   is
        -:  248:   begin
    #####:  249:      return pumpUnit.PUMP_ACTIVE_STATE;
        -:  250:   end GET_PUMP_UNIT_STATE;
        -:  251:
        -:  252:   -----------------------
        -:  253:   -- GET_PUMP_NOZZLE_STATE      --
        -:  254:   -----------------------
    #####:  255:   function GET_PUMP_NOZZLE_STATE(pumpUnit: in PUMP_UNIT) return PUMP.NOZZLE_TYPE
        -:  256:   is
        -:  257:   begin
    #####:  258:      return pumpUnit.PUMP_NOZZLE_STATE;
        -:  259:   end GET_PUMP_NOZZLE_STATE;
        -:  260:
        -:  261:   -----------------------
        -:  262:   --   LEFT_NOZZLE     --
        -:  263:   -----------------------
       10:  264:   procedure LEFT_NOZZLE (pumpUnit: in out PUMP_UNIT; pump_r : in out PUMP.PUMP; fuelType: in PUMP.FUEL_TYPES) is
       10:  265:      liftNozzleException : Exception;
        -:  266:   begin
       10:  267:      pumpUnit.IS_USING:= True;
       10:  268:      if PUMP.STATE_TYPE'Image(pumpUnit.PUMP_ACTIVE_STATE) = "BASE" then
       10:  269:         pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(1);
       10:  270:         pumpUnit.PUMP_ACTIVE_FUEL:= fuelType;
       10:  271:         pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(1);
       10:  272:         PUMP.SET_PUMP_STATE(pump_r, PUMP.STATE_TYPE'Val(1));
       10:  273:         PUMP.SET_PUMP_NOZZLE_STATE(pump_r,  PUMP.NOZZLE_TYPE'Val(1));
       10:  274:         print("left node from base state");
    #####:  275:      elsif PUMP.STATE_TYPE'Image(pumpUnit.PUMP_ACTIVE_STATE) = "WAITING" and PUMP.STATE_TYPE'Image(PUMP.GET_STATE(pump_r)) = "WAITING" then
    #####:  276:         pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(1);
    #####:  277:         pumpUnit.PUMP_ACTIVE_FUEL := fuelType;
    #####:  278:         pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(1);
    #####:  279:         PUMP.SET_PUMP_STATE(pump_r, PUMP.STATE_TYPE'Val(1));
    #####:  280:         PUMP.SET_PUMP_NOZZLE_STATE(pump_r,  PUMP.NOZZLE_TYPE'Val(1));
    #####:  281:         print("left node from waiting state");
        -:  282:      else
    #####:  283:         print("your are not allow use more then one nozzle at same time");
    #####:  284:         Raise liftNozzleException;
        -:  285:      end if;
       10:  286:   end LEFT_NOZZLE;
        -:  287:   -----------------------
        -:  288:   --   RETURN_NOZZLE   --
        -:  289:   -----------------------
        8:  290:   procedure RETURN_NOZZLE (pumpUnit: in out PUMP_UNIT; pump_r: in out PUMP.PUMP) is
        -:  291:      due: PUMP.FLOAT_NUMBER;
        -:  292:      use all type PUMP.FLOAT_NUMBER;
        8:  293:      returnNozzleException : Exception;
        -:  294:   begin
        8:  295:      due:=0.00;
        8:  296:      if PUMP.STATE_TYPE'Image(pumpUnit.PUMP_ACTIVE_STATE) = "READY" and PUMP.STATE_TYPE'Image(PUMP.GET_STATE(pump_r)) = "READY" then
        8:  297:         if pumpUnit.TO_PAY > due then
        8:  298:            pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(3);
        8:  299:            pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(2);
        8:  300:            PUMP.SET_PUMP_STATE(pump_r, PUMP.STATE_TYPE'Val(3));
        8:  301:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r,  PUMP.NOZZLE_TYPE'Val(2));
        8:  302:            print_float_type("return nozzle to waiting state TO_PAY: ", pumpUnit.TO_PAY);
        -:  303:         else
    #####:  304:            pumpUnit.IS_USING:= False;
    #####:  305:            pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(0);
    #####:  306:            pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(0);
    #####:  307:            PUMP.SET_PUMP_STATE(pump_r, PUMP.STATE_TYPE'Val(0));
    #####:  308:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r,  PUMP.NOZZLE_TYPE'Val(0));
    #####:  309:            print("return nozzle to base state TO_PAY = 0");
        -:  310:         end if;
        -:  311:      else
    #####:  312:         print("you are not supports not to use this nozzle other nozzle currently in use");
        -:  313:
    #####:  314:         Raise returnNozzleException;
        -:  315:      end if;
        8:  316:   end RETURN_NOZZLE;
        -:  317:   -----------------------
        -:  318:   --   START_PUMPING   --
        -:  319:   -----------------------
       12:  320:   procedure START_PUMPING (pumpUnit: in out PUMP_UNIT; pump_r: in out PUMP.PUMP; AMOUNT: in PUMP.FLOAT_NUMBER; CAR_TANK_SPACE: in out PUMP.FLOAT_NUMBER)
        -:  321:   is
        -:  322:      use all type PUMP.FLOAT_NUMBER;
        -:  323:      tankSize: PUMP.FLOAT_NUMBER;
        -:  324:      pumped: PUMP.FLOAT_NUMBER;
        -:  325:      SENSOR: Boolean;
        -:  326:      temp: PUMP.FLOAT_NUMBER;
       12:  327:      startPumpingException : Exception;
        -:  328:
        -:  329:   begin
       12:  330:      temp:=0.00;
       12:  331:      pumped:=0.00;
       12:  332:      SENSOR := False;
       12:  333:      if pumpUnit.PUMP_ACTIVE_STATE = PUMP.ready  and pump_r.PUMP_STATE = PUMP.Ready then
       12:  334:         tankSize :=  PUMP.GET_TANKS_SIZE(pump_r);
       12:  335:         print_float_type("tank size: ", tankSize);
       12:  336:         if tankSize <= 0.00 then
    #####:  337:            print("tank empty");
    #####:  338:            Raise startPumpingException;
        -:  339:         end if;
       12:  340:         if CAR_TANK_SPACE <= 0.00 then
    #####:  341:            print("car tank full can not pumping");
    #####:  342:            Raise startPumpingException;
        -:  343:         end if;
       12:  344:         if AMOUNT >0.00 and SENSOR = False and tankSize > temp then
       12:  345:            pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(2);
       12:  346:            pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(3);
       12:  347:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r, PUMP.NOZZLE_TYPE'Val(3));
       12:  348:            PUMP.SET_PUMP_STATE(pump_r,PUMP.STATE_TYPE'Val(2));
        -:  349:            --              while CAR_TANK_SPACE>0.00 and tankSize >temp and SENSOR = False and pumped <= AMOUNT loop
        -:  350:            loop
     4404:  351:               if CAR_TANK_SPACE>0.00 and tankSize >temp and SENSOR = False and pumped <= AMOUNT then
        -:  352:
     4404:  353:                  pumped:= pumped +0.01;
     4404:  354:                  pumpUnit.PUMPED :=pumpUnit.PUMPED + 0.01 ;
     4404:  355:                  pumpUnit.TO_PAY := pumpUnit.TO_PAY + (0.01 * PUMP.GET_UNIT_PRICE(pump_r));
     4404:  356:                  if CAR_TANK_SPACE -0.01 >0.00 then
     4394:  357:                     CAR_TANK_SPACE:= CAR_TANK_SPACE - 0.01;
        -:  358:                  else
       10:  359:                     SENSOR := True;
       10:  360:                     STOP_PUMPING(pumpUnit, pump_r);
       10:  361:                     exit when SENSOR = True;
        -:  362:
        -:  363:                  end if;
        -:  364:                  --                 print_float_type("pumping: " , pumped);
        -:  365:                  --                 print_float_type("car tank space left: ",CAR_TANK_SPACE);
        -:  366:                  --                 print_float_type("Amount To Pay: ", pumpUnit.TO_PAY);
     4394:  367:                  PUMP.REMOVE_PETROL_RESERVOIR(pump_r,0.01);
     4394:  368:                  tankSize := PUMP.GET_TANKS_SIZE(pump_r);
     4394:  369:                  if tankSize <= 1.00E-02 then
    #####:  370:                     STOP_PUMPING(pumpUnit, pump_r);
    #####:  371:                     print("tank empty stop pumping");
    #####:  372:                     exit when tankSize <= 1.00E-02;
     4394:  373:                  elsif pumped>= AMOUNT then
        2:  374:                     print("pumped given amount");
        2:  375:                     STOP_PUMPING(pumpUnit, pump_r);
        2:  376:                     exit when pumped>= AMOUNT;
        -:  377:                  end if;
        -:  378:               end if;
     4392:  379:            end loop;
        -:  380:
        -:  381:            end if;
       12:  382:            if AMOUNT =0.00 and SENSOR = False and tankSize > temp then
    #####:  383:            pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(3);
    #####:  384:            pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(2);
    #####:  385:            PUMP.SET_PUMP_NOZZLE_STATE(pump_r, PUMP.NOZZLE_TYPE'Val(3));
    #####:  386:            PUMP.SET_PUMP_STATE(pump_r,PUMP.STATE_TYPE'Val(2));
        -:  387:
        -:  388:            loop
    #####:  389:               if SENSOR = False and tankSize > 0.00 then
    #####:  390:                  pumpUnit.PUMPED :=pumpUnit.PUMPED + 0.01 ;
    #####:  391:                  pumpUnit.TO_PAY := pumpUnit.TO_PAY + (0.01 * PUMP.GET_UNIT_PRICE(pump_r));
    #####:  392:                  PUMP.REMOVE_PETROL_RESERVOIR(pump_r,0.01);
    #####:  393:                  if CAR_TANK_SPACE -0.01 >0.00 then
    #####:  394:                     print_float_type("1:    ",tankSize);
    #####:  395:                     CAR_TANK_SPACE:= CAR_TANK_SPACE - 0.01;
        -:  396:                  else
    #####:  397:                     SENSOR := True;
    #####:  398:                     STOP_PUMPING(pumpUnit, pump_r);
    #####:  399:                     exit when CAR_TANK_SPACE -0.01 <=0.00;
        -:  400:                  end if;
        -:  401:                  --                 print_float_type("pumping: " , pumped);
        -:  402:                  --                 print_float_type("car tank space left: ",CAR_TANK_SPACE);
        -:  403:                  --                 print_float_type("Amount To Pay: ", pumpUnit.TO_PAY);               PUMP.REMOVE_PETROL_RESERVOIR(pump_r,0.01);
    #####:  404:                  tankSize := PUMP.GET_TANKS_SIZE(pump_r);
    #####:  405:                  print_float_type("2:    ",tankSize);
    #####:  406:                  if tankSize <= 1.00E-02 then
    #####:  407:                     STOP_PUMPING(pumpUnit, pump_r);
    #####:  408:                     print("tank empty stop pumping");
    #####:  409:                     exit when tankSize <= 1.00E-02;
        -:  410:                  end if;
        -:  411:               end if;
    #####:  412:            end loop;
        -:  413:         end if;
        -:  414:      else
    #####:  415:         print("you can not pumping - only read+y state -> pumping");
        -:  416:
    #####:  417:         Raise startPumpingException;
        -:  418:
        -:  419:      end if;
       12:  420:   end START_PUMPING;
        -:  421:   -----------------------
        -:  422:   --   STOP_PUMPING   --
        -:  423:   -----------------------
       12:  424:   procedure STOP_PUMPING(pumpUnit: in out PUMP_UNIT; pump_r: in out PUMP.PUMP) is
       12:  425:      stopPumpingException : Exception;
        -:  426:   begin
       12:  427:      if PUMP.STATE_TYPE'Image(pumpUnit.PUMP_ACTIVE_STATE) = "PUMPING"  and PUMP.STATE_TYPE'Image(PUMP.GET_STATE(pump_r)) = "PUMPING" then
       12:  428:         pumpUnit.PUMP_ACTIVE_STATE := PUMP.STATE_TYPE'Val(1);
       12:  429:         pumpUnit.PUMP_NOZZLE_STATE:= PUMP.NOZZLE_TYPE'Val(4);
       12:  430:         PUMP.SET_PUMP_STATE(pump_r,PUMP.STATE_TYPE'Val(1));
       12:  431:         PUMP.SET_PUMP_NOZZLE_STATE(pump_r, PUMP.NOZZLE_TYPE'Val(4));
       12:  432:         print("stop pumping");
        -:  433:      else
    #####:  434:         Raise stopPumpingException;
        -:  435:
        -:  436:      end if;
        -:  437:
       12:  438:   end STOP_PUMPING;
        -:  439:
        -:  440:end PUMP_UNIT;
